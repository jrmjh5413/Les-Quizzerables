<!DOCTYPE html>
<html>
<head>
    <title>Join Poll</title>
    <style>body { font-family: sans-serif; text-align: center; }</style>
</head>
<body>
    <div id="join-view">
        <h1>Join a Live Poll</h1>
        <input type="text" id="room-code-input" placeholder="Enter Room Code">
        <button onclick="joinRoom()">Join</button>
        <p id="error-message" style="color: red;"></p>
    </div>

    <div id="poll-view" style="display: none;">
        <h1 id="question"></h1>
        <div id="options"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentRoom = '';

        const joinView = document.getElementById('join-view');
        const pollView = document.getElementById('poll-view');
        const errorEl = document.getElementById('error-message');

        function joinRoom() {
            const roomCodeInput = document.getElementById('room-code-input');
            const roomCode = roomCodeInput.value.trim();
            if (roomCode) {
                currentRoom = roomCode;
                socket.emit('join_room', roomCode);
            }
        }

        socket.on('update', (pollData) => {
            joinView.style.display = 'none';
            pollView.style.display = 'block';
            
            const questionEl = document.getElementById('question');
            const optionsEl = document.getElementById('options');

            questionEl.textContent = pollData.question;
            optionsEl.innerHTML = '';
            for (const option in pollData.options) {
                const button = document.createElement('button');
                button.textContent = option;
                button.onclick = () => vote(option);
                optionsEl.appendChild(button);
            }
        });

        function vote(option) {
            socket.emit('vote', { roomCode: currentRoom, option: option });
            pollView.innerHTML = '<h2>Thank you for your vote!</h2>';
        }
        
        socket.on('error_message', (msg) => {
            errorEl.textContent = msg;
        });
    </script>
</body>
</html>
